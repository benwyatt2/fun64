
#^------------------------------
#^title trim=ends
#^------------------------------
{_blog_post_json.title}

#^------------------------------
#^_blog_post_json
#^------------------------------
{
	"title":"Comic test.",
	"author":"xriss",
	"fun_height":"512px",
	"fun_file":"/comic.fun.lua",
}

#^------------------------------
#^_blog_post_body form=markdown
#^------------------------------

{_blog_post_json.title}
-------

Lets see if we can build 4lfa.com style comics using just fun64 :)


<div style="width:100%;height:{_blog_post_json.fun_height};overflow:hidden;"><div style="width:100%;height:{_blog_post_json.fun_height};position:relative;">{fun_code}</div></div>

#^------------------------------
#^fun_code
#^------------------------------

<script id="gamecake_init_lua" type="text/lua" >--<![CDATA[

	local hx,hy,ss=128,128,3

	local opts={
		times=true, -- request simple time keeping samples

		width=hx*ss,	-- display basics
		height=hy*ss,
		screen_scale=ss,
	--	show="full",
		title="fun",
		start="wetgenes.gamecake.fun.main",
		fun="start",
		fps=60,
		... -- include commandline opts
	}

	math.randomseed( os.time() ) -- try and randomise a little bit better

	oven=require("wetgenes.gamecake.oven").bake(opts).preheat()

	return oven:serv()

--]]></script>


	<div id="gamecake_container" style=" width:100%; height:100%; position:absolute; ">
		<canvas id="gamecake_canvas" style=" width:100%; height:100%; position:absolute; " oncontextmenu="event.preventDefault()"></canvas>
		<script type="text/javascript">

			var resize=function(){
				var e=document.getElementById("gamecake_container");
				var w=parseFloat(window.getComputedStyle(e).width);
				var h=parseFloat(window.getComputedStyle(e).height);
				Module.setCanvasSize(w,h);
				if(gamecake_post)
				{
					gamecake_post('cmd=lua\n','require("wetgenes.win").hardcore.resize(nil,'+w+','+h+')');
				}
			};

			var gamecake_start=function() {

//initialise lua
				gamecake_post('cmd=lua\n','require("wetgenes.win").emcc_start({})');

// create a pulse function and call it every frame
				var pulse;
				var resize_wait=16;
				pulse=function() {
					requestAnimationFrame(pulse); // we need to always ask to be called again
					gamecake_post('cmd=lua\n','return gamecake_pulse()');
					if(resize_wait>0)
					{
						if(--resize_wait==0)
						{
							console.log("resioz");
							resize();
						}
					}
				};
				requestAnimationFrame(pulse); // start the updates
			}

			var show_progress=function(n)
			{
				window.show_progress_max=window.show_progress_max || 0;
				if(window.show_progress_max<n) { window.show_progress_max=n; }
				var pct=Math.floor(100*(1-(n/window.show_progress_max)));
				console.log("GameCake Loading "+pct+"%");
			};
			window.addEventListener("resize",resize);
			Module={};
			Module.canvas=document.getElementById("gamecake_canvas");
			Module.canvas_resize=resize;
			Module.memoryInitializerPrefixURL="{_root}exe/";
			Module['_main'] = function() {
				gamecake_post = Module.cwrap('main_post', 'int', ['string','string']);
				gamecake_start();
				resize();
			};
			Module["preInit"] = function() {
				FS.mkdir("/lua");
				FS.createPreloadedFile('/', "start.fun.lua", "{_dirname}/{_blog_post_json.fun_file}", true, false);
				FS.writeFile( "/lua/init.lua" , document.getElementById("gamecake_init_lua").innerHTML );
			};
			Module["monitorRunDependencies"]=show_progress;


		</script>
		<script type="text/javascript" src="{_root}exe/gamecake.js"></script>
	</div>

